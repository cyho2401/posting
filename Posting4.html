<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CEDD Staff Management System</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: #f5f6fa;
      color: #333;
    }

    /* Header */
    .header {
      background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
      color: white;
      padding: 20px 0;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .header-content {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 20px;
    }

    .header h1 {
      font-size: 2.2rem;
      margin-bottom: 5px;
    }

    .header p {
      opacity: 0.9;
      font-size: 1rem;
    }

    /* Container */
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }

    /* Cards */
    .card {
      background: white;
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 25px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.08);
    }

    .card h2 {
      color: #2c3e50;
      margin-bottom: 20px;
      font-size: 1.5rem;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    /* Tabs */
    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 25px;
      border-bottom: 2px solid #e0e0e0;
      flex-wrap: wrap;
    }

    .tab-button {
      padding: 12px 24px;
      background: none;
      border: none;
      border-bottom: 3px solid transparent;
      font-weight: 600;
      color: #666;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 14px;
    }

    .tab-button:hover {
      color: #3498db;
    }

    .tab-button.active {
      color: #3498db;
      border-bottom-color: #3498db;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* Filter Section */
    .filter-section {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }

    .filter-row {
      display: flex;
      gap: 20px;
      margin-bottom: 15px;
      flex-wrap: wrap;
      align-items: flex-end;
    }

    .filter-group {
      flex: 1;
      min-width: 200px;
    }

    .filter-group label {
      display: block;
      font-size: 14px;
      font-weight: 600;
      color: #666;
      margin-bottom: 8px;
    }

    .filter-group select {
      width: 100%;
      padding: 10px;
      border: 2px solid #e0e0e0;
      border-radius: 6px;
      font-size: 14px;
      background: white;
      cursor: pointer;
      transition: all 0.3s;
    }

    .filter-group select:focus {
      outline: none;
      border-color: #3498db;
      box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
    }

    /* Rank Filter Buttons */
    .rank-filters {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 15px;
    }

    .rank-filter-btn {
      padding: 8px 16px;
      background: #e0e0e0;
      border: 2px solid transparent;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s;
      color: #666;
    }

    .rank-filter-btn:hover {
      background: #d0d0d0;
    }

    .rank-filter-btn.active {
      background: #3498db;
      color: white;
      border-color: #2980b9;
    }

    .rank-filter-btn.ce {
      background: #e8d4f1;
      color: #8e44ad;
    }

    .rank-filter-btn.ce.active {
      background: #9b59b6;
      color: white;
    }

    .rank-filter-btn.se {
      background: #dcc9e8;
      color: #7d3c98;
    }

    .rank-filter-btn.se.active {
      background: #8e44ad;
      color: white;
    }

    .rank-filter-btn.e {
      background: #d5b8e5;
      color: #6c3483;
    }

    .rank-filter-btn.e.active {
      background: #7d3c98;
      color: white;
    }

    .rank-filter-btn.ae {
      background: #ceaadf;
      color: #5b2c6f;
    }

    .rank-filter-btn.ae.active {
      background: #6c3483;
      color: white;
    }

    .rank-filter-btn.director {
      background: #fdebd0;
      color: #e67e22;
    }

    .rank-filter-btn.director.active {
      background: #f39c12;
      color: white;
    }

    .rank-filter-btn.chief {
      background: #fadbd8;
      color: #c0392b;
    }

    .rank-filter-btn.chief.active {
      background: #e74c3c;
      color: white;
    }

    /* Department/Office Groups */
    .department-group {
      margin-bottom: 30px;
      border: 1px solid #e0e0e0;
      border-radius: 12px;
      overflow: hidden;
    }

    .department-header {
      background: #34495e;
      color: white;
      padding: 15px 20px;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .department-header:hover {
      background: #2c3e50;
    }

    .department-count {
      background: rgba(255,255,255,0.2);
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 14px;
    }

    .office-group {
      border-bottom: 1px solid #e0e0e0;
    }

    .office-group:last-child {
      border-bottom: none;
    }

    .office-header {
      background: #ecf0f1;
      padding: 12px 20px;
      font-size: 16px;
      font-weight: 600;
      color: #2c3e50;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .office-header:hover {
      background: #d5dbdb;
    }

    .office-count {
      background: #3498db;
      color: white;
      padding: 3px 10px;
      border-radius: 10px;
      font-size: 13px;
    }

    .staff-list {
      background: white;
    }

    .staff-item {
      padding: 12px 20px;
      border-bottom: 1px solid #f0f0f0;
      display: grid;
      grid-template-columns: 30px 1fr 2fr 120px 100px 80px;
      gap: 15px;
      align-items: center;
      cursor: pointer;
      transition: all 0.3s;
    }

    .staff-item:hover {
      background: #f8f9fa;
    }

    .staff-item:last-child {
      border-bottom: none;
    }

    .staff-number {
      color: #666;
      font-size: 13px;
    }

    .staff-name {
      font-weight: 600;
      color: #2c3e50;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .staff-title {
      color: #666;
    }

    .staff-tel {
      color: #666;
      font-size: 14px;
    }

    .staff-postings {
      text-align: center;
    }

    .staff-actions {
      display: flex;
      gap: 5px;
    }

    /* Badges */
    .rank-badge {
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
    }

    .ce-badge {
      background: #9b59b6;
      color: white;
    }

    .se-badge {
      background: #8e44ad;
      color: white;
    }

    .e-badge {
      background: #7d3c98;
      color: white;
    }

    .ae-badge {
      background: #6c3483;
      color: white;
    }

    .director-badge {
      background: #f39c12;
      color: white;
    }

    .chief-badge {
      background: #e74c3c;
      color: white;
    }

    .posting-match {
      background: #27ae60;
      color: white;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
    }

    .duplicate-indicator {
      background: #3498db;
      color: white;
      padding: 2px 6px;
      border-radius: 8px;
      font-size: 10px;
      font-weight: 600;
    }

    /* Action Buttons */
    .action-btn {
      padding: 4px 8px;
      border: 1px solid #e0e0e0;
      border-radius: 4px;
      background: white;
      font-size: 11px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .action-btn:hover {
      background: #3498db;
      color: white;
      border-color: #3498db;
    }

    .action-btn.edit {
      border-color: #3498db;
      color: #3498db;
    }

    .action-btn.edit:hover {
      background: #3498db;
      color: white;
    }

    /* Edit Form */
    .edit-form {
      padding: 20px;
      background: #f8f9fa;
      border-radius: 8px;
    }

    .edit-form input,
    .edit-form select {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      border: 2px solid #e0e0e0;
      border-radius: 6px;
      font-size: 14px;
    }

    .edit-form input:focus,
    .edit-form select:focus {
      outline: none;
      border-color: #3498db;
      box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
    }

    .edit-form label {
      display: block;
      font-size: 14px;
      font-weight: 600;
      color: #666;
      margin-bottom: 5px;
    }

    .edit-actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 20px;
    }

    /* Collapsible */
    .collapsible-content {
      display: none;
    }

    .collapsible-content.show {
      display: block;
    }

    .toggle-icon {
      transition: transform 0.3s;
    }

    .toggle-icon.rotated {
      transform: rotate(90deg);
    }

    /* Forms */
    input[type="file"] {
      padding: 10px;
      border: 2px dashed #3498db;
      border-radius: 6px;
      width: 100%;
      margin-bottom: 15px;
      cursor: pointer;
      background: #f8f9fa;
    }

    textarea {
      width: 100%;
      height: 200px;
      padding: 15px;
      border: 2px solid #e0e0e0;
      border-radius: 6px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      resize: vertical;
      transition: border-color 0.3s;
      margin-bottom: 15px;
    }

    textarea:focus {
      outline: none;
      border-color: #3498db;
      box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
    }

    /* Buttons */
    button {
      padding: 10px 20px;
      background: #3498db;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    button:hover {
      background: #2980b9;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
    }

    button:disabled {
      background: #95a5a6;
      cursor: not-allowed;
      transform: none;
    }

    .btn-secondary {
      background: #95a5a6;
    }

    .btn-secondary:hover {
      background: #7f8c8d;
    }

    .btn-success {
      background: #27ae60;
    }

    .btn-success:hover {
      background: #229954;
    }

    .btn-danger {
      background: #e74c3c;
    }

    .btn-danger:hover {
      background: #c0392b;
    }

    /* Status Messages */
    .status {
      margin-top: 15px;
      padding: 12px 20px;
      border-radius: 6px;
      font-weight: 500;
      display: none;
    }

    .status.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
      display: block;
    }

    .status.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
      display: block;
    }

    .status.info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
      display: block;
    }

    /* Loading Spinner */
    .loader {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid #3498db;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-left: 10px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Stats */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 25px;
    }

    .stat-card {
      background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
      color: white;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      transition: transform 0.3s;
    }

    .stat-card:hover {
      transform: translateY(-2px);
    }

    .stat-card.purple {
      background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
    }

    .stat-card.orange {
      background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
    }

    .stat-card.red {
      background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
    }

    .stat-card.green {
      background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
    }

    .stat-card h3 {
      font-size: 2rem;
      margin-bottom: 5px;
    }

    .stat-card p {
      opacity: 0.9;
      font-size: 0.9rem;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      overflow-y: auto;
    }

    .modal-content {
      background: white;
      max-width: 800px;
      margin: 50px auto;
      padding: 30px;
      border-radius: 12px;
      position: relative;
      max-height: 90vh;
      overflow-y: auto;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #e0e0e0;
    }

    .modal-close {
      font-size: 28px;
      cursor: pointer;
      color: #666;
      line-height: 1;
    }

    .modal-close:hover {
      color: #333;
    }

    /* Duplicate List */
    .duplicate-group {
      margin-bottom: 20px;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 8px;
      border: 1px solid #e0e0e0;
    }

    .duplicate-group h4 {
      margin-bottom: 10px;
      color: #2c3e50;
    }

    .duplicate-item {
      padding: 10px;
      margin-bottom: 5px;
      background: white;
      border-radius: 4px;
      font-size: 14px;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .header h1 {
        font-size: 1.5rem;
      }
      
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .staff-item {
        grid-template-columns: 1fr;
        gap: 8px;
      }
      
      .filter-row {
        flex-direction: column;
      }
      
      .filter-group {
        min-width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="header-content">
      <h1>📋 CEDD Staff Management System</h1>
      <p>Engineers and Management Directory</p>
    </div>
  </div>

  <div class="container">
    <!-- Statistics Dashboard -->
    <div class="stats-grid" id="statsGrid">
      <div class="stat-card purple">
        <h3 id="totalEngineers">0</h3>
        <p>Total Engineers</p>
      </div>
      <div class="stat-card orange">
        <h3 id="totalDirectors">0</h3>
        <p>Directors</p>
      </div>
      <div class="stat-card red">
        <h3 id="totalChiefs">0</h3>
        <p>Chiefs/Heads</p>
      </div>
      <div class="stat-card green">
        <h3 id="totalWithPostings">0</h3>
        <p>With Postings</p>
      </div>
    </div>

    <!-- Tabs -->
    <div class="tabs">
      <button class="tab-button active" onclick="switchTab('staff')">Staff Directory</button>
      <button class="tab-button" onclick="switchTab('upload')">Upload Data</button>
      <button class="tab-button" onclick="switchTab('postings')">Posting Notices</button>
      <button class="tab-button" onclick="switchTab('duplicates')">Duplicate Names</button>
    </div>

    <!-- Staff List Tab -->
    <div id="staffTab" class="tab-content active">
      <div class="card">
        <h2>👷 Engineers & Management Directory</h2>
        
        <!-- Filter Section -->
        <div class="filter-section">
          <!-- Rank Filters -->
          <div class="filter-group">
            <label>Filter by Rank Categories:</label>
            <div class="rank-filters" id="rankFilters">
              <button class="rank-filter-btn ce" onclick="toggleRankFilter('ce')">CE/Chief Engineer</button>
              <button class="rank-filter-btn se" onclick="toggleRankFilter('se')">SE/Senior Engineer</button>
              <button class="rank-filter-btn e" onclick="toggleRankFilter('e')">E/Engineer</button>
              <button class="rank-filter-btn ae" onclick="toggleRankFilter('ae')">AE/Assistant Engineer</button>
              <button class="rank-filter-btn director" onclick="toggleRankFilter('director')">Directors</button>
              <button class="rank-filter-btn chief" onclick="toggleRankFilter('chief')">Chiefs/Heads</button>
              <button class="rank-filter-btn" onclick="toggleRankFilter('all')">Show All</button>
            </div>
          </div>
          
          <!-- Department and Office Filters -->
          <div class="filter-row">
            <div class="filter-group">
              <label for="departmentFilter">Department:</label>
              <select id="departmentFilter" onchange="applyFilters()">
                <option value="">All Departments</option>
              </select>
            </div>
            
            <div class="filter-group">
              <label for="officeFilter">Office:</label>
              <select id="officeFilter" onchange="applyFilters()">
                <option value="">All Offices</option>
              </select>
            </div>
            
            <div class="filter-group">
              <label>&nbsp;</label>
              <button onclick="resetFilters()" class="btn-secondary">Reset Filters</button>
            </div>
          </div>
        </div>

        <!-- Grouped Staff List -->
        <div id="groupedStaffList"></div>
      </div>
    </div>

    <!-- Upload Tab -->
    <div id="uploadTab" class="tab-content">
      <div class="card">
        <h2>📤 Upload Staff Data (CSV)</h2>
        
        <input type="file" id="csvFile" accept=".csv">
        <button onclick="uploadCSV()">📤 Upload Staff CSV</button>
        <button class="btn-secondary" onclick="clearStaffData()">🗑️ Clear All Staff Data</button>
        
        <div id="csvStatus" class="status"></div>
      </div>

      <div class="card">
        <h2>📋 Upload Posting Notices (JSON)</h2>
        
        <textarea id="jsonInput" placeholder='Paste posting notices in JSON format...'></textarea>
        <button onclick="uploadPostings()">📤 Upload Postings</button>
        <button class="btn-secondary" onclick="clearPostingsInput()">🗑️ Clear Input</button>
        
        <div id="postingStatus" class="status"></div>
      </div>
    </div>

    <!-- Postings Tab -->
    <div id="postingsTab" class="tab-content">
      <div class="card">
        <h2>📋 Recent Posting Notices</h2>
        
        <div id="postingsContent"></div>
      </div>
    </div>

    <!-- Duplicates Tab -->
    <div id="duplicatesTab" class="tab-content">
      <div class="card">
        <h2>👥 Duplicate Names</h2>
        
        <div id="duplicatesContent"></div>
      </div>
    </div>
  </div>

  <!-- Staff Detail Modal -->
  <div id="staffModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modalTitle">Staff Details</h2>
        <span class="modal-close" onclick="closeModal()">&times;</span>
      </div>
      <div id="modalBody"></div>
    </div>
  </div>

  <!-- Edit Modal -->
  <div id="editModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Edit Staff Information</h2>
        <span class="modal-close" onclick="closeEditModal()">&times;</span>
      </div>
      <div id="editModalBody"></div>
    </div>
  </div>

  <script>
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDc0NVogv24jSepYYKS1Dbw3Y32IlRBJ_A",
      authDomain: "posting-notice.firebaseapp.com",
      projectId: "posting-notice",
      storageBucket: "posting-notice.firebasestorage.app",
      messagingSenderId: "245130394809",
      appId: "1:245130394809:web:c428677d6cc884ef0eaf68",
      measurementId: "G-TY0K1VQPX5"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Global variables
    let allStaff = [];
    let filteredStaff = [];
    let allPostings = [];
    let staffPostingsMap = new Map();
    let duplicateGroups = new Map();
    let activeRankFilters = new Set();
    let collapsedDepartments = new Set();
    let collapsedOffices = new Set();

    // Rank hierarchy for sorting
    const rankHierarchy = {
      // Directors
      'Director': 100, 'Dir': 100, 'D': 100,
      'Deputy Director': 95, 'Dep Dir': 95, 'DD': 95,
      'Assistant Director': 90, 'Asst Dir': 90, 'AD': 90,
      
      // Chiefs and Heads
      'Head': 85, 'Dep Head': 83,
      'Chief': 80, 'Ch': 80,
      'Project Manager': 78, 'PM': 78,
      'Project Team Leader': 76,
      'Commissioner': 75, 'Comr': 75,
      
      // Engineers
      'Chief Engineer': 70, 'CE': 70, 'Ch Engr': 70,
      'Chief Geotechnical Engineer': 70, 'Ch Geo Engr': 70,
      'Senior Engineer': 65, 'SE': 65, 'Sr Engr': 65,
      'Senior Geotechnical Engineer': 65, 'Sr Geo Engr': 65,
      'Engineer': 60, 'E': 60, 'Engr': 60,
      'Geotechnical Engineer': 60, 'Geo Engr': 60,
      'Assistant Engineer': 55, 'AE': 55, 'Asst Engr': 55,
      'Assistant Geotechnical Engineer': 55, 'Asst Geo Engr': 55,
      
      // Technical Officers (not chiefs)
      'Principal Technical Officer': 50, 'PTO': 50, 'Prin Tech Offr': 50,
      'Senior Technical Officer': 45, 'STO': 45, 'Sr Tech Offr': 45,
      'Technical Officer': 40, 'TO': 40, 'Tech Offr': 40,
      
      // Other management
      'Principal': 48, 'Prin': 48,
      'Manager': 47,
      'Secretary': 46,
      'Officer': 35
    };

    // Define patterns for categorization
    const cePatterns = [
      /^Chief Engineer/i, /^CE\b/i, /^Ch\s*Engr/i,
      /^Chief\s+Geo(?:technical)?\s*Engr/i, /^Ch\s*Geo\s*Engr/i
    ];

    const sePatterns = [
      /^Senior Engineer/i, /^SE\b/i, /^Sr\s*Engr/i,
      /^Senior\s+Geo(?:technical)?\s*Engr/i, /^Sr\s*Geo\s*Engr/i
    ];

    const ePatterns = [
      /^Engineer(?!\s*Specialist)/i, /^E\b/i, /^Engr\b/i,
      /^Geo(?:technical)?\s*Engr/i
    ];

    const aePatterns = [
      /^Assistant Engineer/i, /^AE\b/i, /^Asst\s*Engr/i,
      /^Assistant\s+Geo(?:technical)?\s*Engr/i, /^Asst\s*Geo\s*Engr/i
    ];

    const directorPatterns = [
      /^Director/i, /^Dir\b/i, /^D\b/i,
      /^Deputy Director/i, /^Dep\s*Dir/i, /^DD\b/i,
      /^Assistant Director/i, /^Asst\s*Dir/i, /^AD\b/i
    ];

    const chiefManagementPatterns = [
      /^Head\s+of/i, /^Dep\s*Head/i,
      /^Chief(?!\s+Engineer|\s+Geo)/i, /^Ch\b(?!\s*Engr|\s*Geo)/i,
      /Project\s*Manager/i, /^PM\b/i,
      /Project\s*Team\s*Leader/i,
      /Commissioner/i, /Comr\./i
    ];

    // Initialize app
    document.addEventListener('DOMContentLoaded', async () => {
      await loadAllData();
    });

    // Remove title from name for display
    function removeTitle(name) {
      if (!name) return '';
      
      const titles = ['Mr\\.?', 'Ms\\.?', 'Miss\\.?', 'Mrs\\.?', 'Dr\\.?', 'Prof\\.?'];
      let cleanName = name;
      
      titles.forEach(title => {
        const regex = new RegExp(`^${title}\\s+`, 'i');
        cleanName = cleanName.replace(regex, '');
      });
      
      return cleanName.trim();
    }

    // Normalize name for matching
    function normalizeName(name) {
      if (!name) return '';
      
      let normalized = removeTitle(name).toUpperCase();
      normalized = normalized
        .replace(/\s+/g, ' ')
        .replace(/\s*-\s*/g, '-')
        .trim();
      
      const coreParts = normalized.split(',');
      if (coreParts.length > 0) {
        normalized = coreParts[0].trim();
      }
      
      return normalized;
    }

    // Get rank score for sorting
    function getRankScore(postTitle) {
      if (!postTitle) return 0;
      
      // Check exact matches first
      for (let [pattern, score] of Object.entries(rankHierarchy)) {
        if (postTitle.toLowerCase().includes(pattern.toLowerCase())) {
          return score;
        }
      }
      
      return 0;
    }

    // Check if position matches filters
    function isEngineerOrManagement(postTitle) {
      if (!postTitle) return false;
      
      const allPatterns = [
        ...cePatterns, ...sePatterns, ...ePatterns, ...aePatterns,
        ...directorPatterns, ...chiefManagementPatterns
      ];
      
      for (let pattern of allPatterns) {
        if (pattern.test(postTitle)) return true;
      }
      
      return false;
    }

    // Get rank category
    function getRankCategory(postTitle) {
      if (!postTitle) return null;
      
      // Check specific engineer ranks first
      for (let pattern of cePatterns) {
        if (pattern.test(postTitle)) return 'ce';
      }
      
      for (let pattern of sePatterns) {
        if (pattern.test(postTitle)) return 'se';
      }
      
      for (let pattern of ePatterns) {
        if (pattern.test(postTitle)) return 'e';
      }
      
      for (let pattern of aePatterns) {
        if (pattern.test(postTitle)) return 'ae';
      }
      
      for (let pattern of directorPatterns) {
        if (pattern.test(postTitle)) return 'director';
      }
      
      for (let pattern of chiefManagementPatterns) {
        if (pattern.test(postTitle)) return 'chief';
      }
      
      return null;
    }

    // Find exact duplicate names only
    function findDuplicateGroups() {
      duplicateGroups.clear();
      const nameMap = new Map();
      
      // Group by exact normalized names only
      allStaff.forEach(staff => {
        const normalized = normalizeName(staff.fullName);
        
        if (!nameMap.has(normalized)) {
          nameMap.set(normalized, []);
        }
        nameMap.get(normalized).push(staff);
      });
      
      // Keep only groups with multiple people
      nameMap.forEach((group, key) => {
        if (group.length > 1) {
          duplicateGroups.set(key, group);
        }
      });
    }

    // Toggle rank filter
    function toggleRankFilter(category) {
      if (category === 'all') {
        activeRankFilters.clear();
      } else {
        if (activeRankFilters.has(category)) {
          activeRankFilters.delete(category);
        } else {
          activeRankFilters.add(category);
        }
      }
      
      updateRankFilterButtons();
      applyFilters();
    }

    // Update rank filter button states
    function updateRankFilterButtons() {
      const buttons = document.querySelectorAll('.rank-filter-btn');
      buttons.forEach(btn => {
        btn.classList.remove('active');
      });
      
      if (activeRankFilters.size === 0) {
        buttons.forEach(btn => {
          if (btn.textContent === 'Show All') {
            btn.classList.add('active');
          }
        });
      } else {
        activeRankFilters.forEach(filter => {
          buttons.forEach(btn => {
            if (btn.classList.contains(filter)) {
              btn.classList.add('active');
            }
          });
        });
      }
    }

    // Apply filters
    function applyFilters() {
      const department = document.getElementById('departmentFilter').value;
      const office = document.getElementById('officeFilter').value;
      
      filteredStaff = allStaff.filter(staff => {
        // First filter by engineer/management
        if (!isEngineerOrManagement(staff.postTitle)) return false;
        
        // Apply rank category filter
        if (activeRankFilters.size > 0) {
          const category = getRankCategory(staff.postTitle);
          if (!category || !activeRankFilters.has(category)) return false;
        }
        
        // Apply department filter
        if (department && staff.department !== department) return false;
        
        // Apply office filter
        if (office && staff.office !== office) return false;
        
        return true;
      });
      
      displayGroupedStaff();
    }

    // Reset filters
    function resetFilters() {
      document.getElementById('departmentFilter').value = '';
      document.getElementById('officeFilter').value = '';
      activeRankFilters.clear();
      updateRankFilterButtons();
      applyFilters();
    }

    // Toggle department collapse
    function toggleDepartment(dept) {
      if (collapsedDepartments.has(dept)) {
        collapsedDepartments.delete(dept);
      } else {
        collapsedDepartments.add(dept);
      }
      displayGroupedStaff();
    }

    // Toggle office collapse
    function toggleOffice(key) {
      if (collapsedOffices.has(key)) {
        collapsedOffices.delete(key);
      } else {
        collapsedOffices.add(key);
      }
      displayGroupedStaff();
    }

    // Display grouped staff
    function displayGroupedStaff() {
      const container = document.getElementById('groupedStaffList');
      
      // Group by department and office
      const departmentGroups = new Map();
      
      filteredStaff.forEach(staff => {
        const dept = staff.department || 'Unknown Department';
        if (!departmentGroups.has(dept)) {
          departmentGroups.set(dept, new Map());
        }
        
        const officeMap = departmentGroups.get(dept);
        const office = staff.office || 'No Office';
        
        if (!officeMap.has(office)) {
          officeMap.set(office, []);
        }
        
        officeMap.get(office).push(staff);
      });
      
      // Sort departments
      const sortedDepts = Array.from(departmentGroups.keys()).sort();
      
      let html = '';
      let globalIndex = 1;
      
      sortedDepts.forEach(dept => {
        const officeMap = departmentGroups.get(dept);
        const deptStaffCount = Array.from(officeMap.values()).reduce((sum, staff) => sum + staff.length, 0);
        const isCollapsed = collapsedDepartments.has(dept);
        
        html += `
          <div class="department-group">
            <div class="department-header" onclick="toggleDepartment('${dept}')">
              <span>
                <span class="toggle-icon ${isCollapsed ? '' : 'rotated'}">▶</span>
                ${dept}
              </span>
              <span class="department-count">${deptStaffCount} staff</span>
            </div>
            <div class="collapsible-content ${isCollapsed ? '' : 'show'}">
        `;
        
        // Sort offices
        const sortedOffices = Array.from(officeMap.keys()).sort();
        
        sortedOffices.forEach(office => {
          const officeStaff = officeMap.get(office);
          const officeKey = `${dept}|${office}`;
          const isOfficeCollapsed = collapsedOffices.has(officeKey);
          
          // Sort staff by rank score (highest first)
          officeStaff.sort((a, b) => {
            const scoreA = getRankScore(a.postTitle);
            const scoreB = getRankScore(b.postTitle);
            return scoreB - scoreA;
          });
          
          html += `
            <div class="office-group">
              <div class="office-header" onclick="toggleOffice('${officeKey}')">
                <span>
                  <span class="toggle-icon ${isOfficeCollapsed ? '' : 'rotated'}">▶</span>
                  ${office}
                </span>
                <span class="office-count">${officeStaff.length}</span>
              </div>
              <div class="staff-list collapsible-content ${isOfficeCollapsed ? '' : 'show'}">
          `;
          
          officeStaff.forEach(staff => {
            const displayName = staff.displayName || removeTitle(staff.fullName);
            const postings = staffPostingsMap.get(staff.id) || [];
            const category = getRankCategory(staff.postTitle);
            
            let rankBadge = '';
            if (category === 'ce') {
              rankBadge = '<span class="rank-badge ce-badge">CE</span>';
            } else if (category === 'se') {
              rankBadge = '<span class="rank-badge se-badge">SE</span>';
            } else if (category === 'e') {
              rankBadge = '<span class="rank-badge e-badge">E</span>';
            } else if (category === 'ae') {
              rankBadge = '<span class="rank-badge ae-badge">AE</span>';
            } else if (category === 'director') {
              rankBadge = '<span class="rank-badge director-badge">DIR</span>';
            } else if (category === 'chief') {
              rankBadge = '<span class="rank-badge chief-badge">CHIEF</span>';
            }
            
            // Check for exact duplicates only
            const normalized = normalizeName(staff.fullName);
            const isDuplicate = duplicateGroups.has(normalized) && duplicateGroups.get(normalized).length > 1;
            
            html += `
              <div class="staff-item">
                <div class="staff-number">${globalIndex++}</div>
                <div class="staff-name" onclick="viewStaffDetails('${staff.id}')">
                  ${displayName}
                  ${rankBadge}
                  ${isDuplicate ? '<span class="duplicate-indicator">DUP</span>' : ''}
                </div>
                <div class="staff-title">${staff.postTitle}</div>
                <div class="staff-tel">${staff.officeTel || '-'}</div>
                <div class="staff-postings">
                  ${postings.length > 0 ? 
                    `<span class="posting-match">${postings.length}</span>` : 
                    '-'
                  }
                </div>
                <div class="staff-actions">
                  <button class="action-btn edit" onclick="editStaff('${staff.id}', event)">Edit</button>
                </div>
              </div>
            `;
          });
          
          html += '</div></div>';
        });
        
        html += '</div></div>';
      });
      
      if (filteredStaff.length === 0) {
        html = '<div style="text-align: center; padding: 40px; color: #666;">No staff found matching the selected filters.</div>';
      }
      
      container.innerHTML = html;
    }

    // Edit staff
    function editStaff(staffId, event) {
      event.stopPropagation();
      
      const staff = allStaff.find(s => s.id === staffId);
      if (!staff) return;
      
      const modal = document.getElementById('editModal');
      const modalBody = document.getElementById('editModalBody');
      
      modalBody.innerHTML = `
        <form class="edit-form" onsubmit="saveStaffEdit('${staffId}', event)">
          <div>
            <label>Full Name (with title):</label>
            <input type="text" id="editFullName" value="${staff.fullName || ''}" required>
          </div>
          
          <div>
            <label>Post Title:</label>
            <input type="text" id="editPostTitle" value="${staff.postTitle || ''}" required>
          </div>
          
          <div>
            <label>Department:</label>
            <input type="text" id="editDepartment" value="${staff.department || ''}" required>
          </div>
          
          <div>
            <label>Office:</label>
            <input type="text" id="editOffice" value="${staff.office || ''}">
          </div>
          
          <div>
            <label>Office Tel:</label>
            <input type="text" id="editOfficeTel" value="${staff.officeTel || ''}">
          </div>
          
          <div class="edit-actions">
            <button type="submit" class="btn-success">Save Changes</button>
            <button type="button" class="btn-secondary" onclick="closeEditModal()">Cancel</button>
            <button type="button" class="btn-danger" onclick="deleteStaff('${staffId}')">Delete</button>
          </div>
        </form>
        
        <div id="editStatus" class="status" style="display: none;"></div>
      `;
      
      modal.style.display = 'block';
    }

    // Save staff edit
    async function saveStaffEdit(staffId, event) {
      event.preventDefault();
      
      const fullName = document.getElementById('editFullName').value;
      const postTitle = document.getElementById('editPostTitle').value;
      const department = document.getElementById('editDepartment').value;
      const office = document.getElementById('editOffice').value;
      const officeTel = document.getElementById('editOfficeTel').value;
      
      const status = document.getElementById('editStatus');
      status.innerHTML = '<span class="loader"></span> Saving changes...';
      status.className = 'status info';
      status.style.display = 'block';
      
      try {
        await db.collection('staff').doc(staffId).update({
          fullName,
          postTitle,
          department,
          office,
          officeTel,
          displayName: removeTitle(fullName),
          normalizedName: normalizeName(fullName),
          updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        showStatus(status, 'success', '✅ Changes saved successfully');
        
        setTimeout(() => {
          closeEditModal();
          loadAllData();
        }, 1500);
        
      } catch (error) {
        showStatus(status, 'error', `❌ Error: ${error.message}`);
      }
    }

    // Delete staff
    async function deleteStaff(staffId) {
      if (!confirm('Are you sure you want to delete this staff member? This cannot be undone.')) {
        return;
      }
      
      const status = document.getElementById('editStatus');
      status.innerHTML = '<span class="loader"></span> Deleting...';
      status.className = 'status info';
      status.style.display = 'block';
      
      try {
        await db.collection('staff').doc(staffId).delete();
        
        showStatus(status, 'success', '✅ Staff member deleted');
        
        setTimeout(() => {
          closeEditModal();
          loadAllData();
        }, 1500);
        
      } catch (error) {
        showStatus(status, 'error', `❌ Error: ${error.message}`);
      }
    }

    // Display duplicates
    function displayDuplicates() {
      const container = document.getElementById('duplicatesContent');
      
      if (duplicateGroups.size === 0) {
        container.innerHTML = '<p style="text-align: center; padding: 40px; color: #666;">No duplicate names found.</p>';
        return;
      }
      
      let html = '<div style="margin-bottom: 20px;">';
      html += `<p>Found ${duplicateGroups.size} exact duplicate names. These are different people with the same name.</p>`;
      html += '</div>';
      
      duplicateGroups.forEach((group, name) => {
        html += `
          <div class="duplicate-group">
            <h4>Name: ${name} (${group.length} people)</h4>
        `;
        
        group.forEach(staff => {
          html += `
            <div class="duplicate-item">
              <strong>${staff.fullName}</strong><br>
              ${staff.postTitle} - ${staff.department}<br>
              ${staff.office || 'No Office'} | Tel: ${staff.officeTel || 'N/A'}
            </div>
          `;
        });
        
        html += '</div>';
      });
      
      container.innerHTML = html;
    }

    // Load all data
    async function loadAllData() {
      await loadStaffData();
      await loadPostingsData();
      findDuplicateGroups();
      matchStaffWithPostings();
      updateStatistics();
      populateFilters();
      applyFilters();
    }

    // Load staff data
    async function loadStaffData() {
      try {
        const snapshot = await db.collection('staff').get();
        allStaff = [];
        
        snapshot.forEach(doc => {
          const data = doc.data();
          allStaff.push({ 
            id: doc.id, 
            ...data,
            displayName: data.displayName || removeTitle(data.fullName)
          });
        });
        
      } catch (error) {
        console.error('Error loading staff data:', error);
      }
    }

    // Load postings data
    async function loadPostingsData() {
      try {
        const snapshot = await db.collection('postings').get();
        allPostings = [];
        
        snapshot.forEach(doc => {
          allPostings.push({ id: doc.id, ...doc.data() });
        });
        
        allPostings.sort((a, b) => (b.dateFrom || '').localeCompare(a.dateFrom || ''));
        
      } catch (error) {
        console.error('Error loading postings data:', error);
      }
    }

    // Match staff with postings
    function matchStaffWithPostings() {
      staffPostingsMap.clear();
      
      allPostings.forEach(posting => {
        const postingNormalized = normalizeName(posting.name);
        
        allStaff.forEach(staff => {
          const staffNormalized = normalizeName(staff.fullName);
          
          if (staffNormalized === postingNormalized) {
            if (!staffPostingsMap.has(staff.id)) {
              staffPostingsMap.set(staff.id, []);
            }
            staffPostingsMap.get(staff.id).push(posting);
          }
        });
      });
    }

    // Populate filter dropdowns
    function populateFilters() {
      const departments = new Set();
      const offices = new Set();
      
      allStaff.forEach(staff => {
        if (staff.department) departments.add(staff.department);
        if (staff.office) offices.add(staff.office);
      });
      
      const deptSelect = document.getElementById('departmentFilter');
      deptSelect.innerHTML = '<option value="">All Departments</option>';
      Array.from(departments).sort().forEach(dept => {
        deptSelect.innerHTML += `<option value="${dept}">${dept}</option>`;
      });
      
      const officeSelect = document.getElementById('officeFilter');
      officeSelect.innerHTML = '<option value="">All Offices</option>';
      Array.from(offices).sort().forEach(office => {
        officeSelect.innerHTML += `<option value="${office}">${office}</option>`;
      });
    }

    // Update statistics
    function updateStatistics() {
      let engineerCount = 0;
      let directorCount = 0;
      let chiefCount = 0;
      let withPostingsCount = 0;
      
      allStaff.forEach(staff => {
        if (!isEngineerOrManagement(staff.postTitle)) return;
        
        const category = getRankCategory(staff.postTitle);
        if (['ce', 'se', 'e', 'ae'].includes(category)) engineerCount++;
        else if (category === 'director') directorCount++;
        else if (category === 'chief') chiefCount++;
        
        if (staffPostingsMap.has(staff.id)) {
          withPostingsCount++;
        }
      });
      
      document.getElementById('totalEngineers').textContent = engineerCount;
      document.getElementById('totalDirectors').textContent = directorCount;
      document.getElementById('totalChiefs').textContent = chiefCount;
      document.getElementById('totalWithPostings').textContent = withPostingsCount;
    }

    // View staff details
    function viewStaffDetails(staffId) {
      const staff = allStaff.find(s => s.id === staffId);
      if (!staff) return;
      
      const postings = staffPostingsMap.get(staffId) || [];
      const modal = document.getElementById('staffModal');
      const modalTitle = document.getElementById('modalTitle');
      const modalBody = document.getElementById('modalBody');
      
      modalTitle.textContent = `Staff Details: ${removeTitle(staff.fullName)}`;
      
      let html = `
        <div style="margin-bottom: 20px;">
          <h3 style="color: #2c3e50; margin-bottom: 15px;">Basic Information</h3>
          <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
            <div>
              <strong>Full Name:</strong> ${staff.fullName}
            </div>
            <div>
              <strong>Display Name:</strong> ${removeTitle(staff.fullName)}
            </div>
            <div>
              <strong>Post Title:</strong> ${staff.postTitle}
            </div>
            <div>
              <strong>Department:</strong> ${staff.department}
            </div>
            <div>
              <strong>Office:</strong> ${staff.office || 'N/A'}
            </div>
            <div>
              <strong>Office Tel:</strong> ${staff.officeTel || 'N/A'}
            </div>
          </div>
          
          <div style="margin-top: 20px;">
            <button class="action-btn edit" onclick="editStaff('${staffId}', event)">Edit Information</button>
          </div>
        </div>
      `;
      
      if (postings.length > 0) {
        html += `
          <div>
            <h3 style="color: #2c3e50; margin-bottom: 15px;">Posting History (${postings.length})</h3>
            <table style="width: 100%; font-size: 14px;">
              <thead>
                <tr>
                  <th style="background: #3498db; color: white; padding: 8px;">Date</th>
                  <th style="background: #3498db; color: white; padding: 8px;">From</th>
                  <th style="background: #3498db; color: white; padding: 8px;">To</th>
                  <th style="background: #3498db; color: white; padding: 8px;">Notice ID</th>
                  <th style="background: #3498db; color: white; padding: 8px;">Remarks</th>
                </tr>
              </thead>
              <tbody>
                ${postings.map(p => `
                  <tr>
                    <td style="padding: 8px; border-bottom: 1px solid #e0e0e0;">${p.dateFrom || 'N/A'}</td>
                    <td style="padding: 8px; border-bottom: 1px solid #e0e0e0;">${p.from || 'N/A'}</td>
                    <td style="padding: 8px; border-bottom: 1px solid #e0e0e0;">${p.to || 'N/A'}</td>
                    <td style="padding: 8px; border-bottom: 1px solid #e0e0e0;">${p.noticeId || 'N/A'}</td>
                    <td style="padding: 8px; border-bottom: 1px solid #e0e0e0;">${p.remarks || '-'}</td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          </div>
        `;
      } else {
        html += '<p style="color: #666;">No posting notices found for this staff member.</p>';
      }
      
      modalBody.innerHTML = html;
      modal.style.display = 'block';
    }

    // Close modals
    function closeModal() {
      document.getElementById('staffModal').style.display = 'none';
    }

    function closeEditModal() {
      document.getElementById('editModal').style.display = 'none';
    }

    // Switch tabs
    function switchTab(tabName) {
      document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('active');
      });
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
      });
      
      event.target.classList.add('active');
      document.getElementById(tabName + 'Tab').classList.add('active');
      
      if (tabName === 'duplicates') {
        displayDuplicates();
      }
    }

    // Parse CSV
    function parseCSV(text) {
      const lines = text.split('\n').filter(line => line.trim());
      const headers = parseCSVLine(lines[0]);
      const data = [];
      
      for (let i = 1; i < lines.length; i++) {
        const values = parseCSVLine(lines[i]);
        const row = {};
        headers.forEach((header, index) => {
          row[header.trim()] = values[index] ? values[index].trim() : '';
        });
        data.push(row);
      }
      
      return data;
    }

    function parseCSVLine(line) {
      const result = [];
      let current = '';
      let inQuotes = false;
      let i = 0;
      
      while (i < line.length) {
        const char = line[i];
        
        if (char === '"') {
          if (inQuotes && line[i + 1] === '"') {
            current += '"';
            i++;
          } else {
            inQuotes = !inQuotes;
          }
        } else if (char === ',' && !inQuotes) {
          result.push(current);
          current = '';
        } else {
          current += char;
        }
        
        i++;
      }
      
      result.push(current);
      return result;
    }

    // Upload CSV
    async function uploadCSV() {
      const fileInput = document.getElementById('csvFile');
      const status = document.getElementById('csvStatus');
      
      if (!fileInput.files.length) {
        showStatus(status, 'error', '❌ Please select a CSV file');
        return;
      }
      
      const file = fileInput.files[0];
      const reader = new FileReader();
      
      status.innerHTML = '<span class="loader"></span> Processing CSV file...';
      status.className = 'status info';
      
      reader.onload = async (e) => {
        try {
          const csvData = parseCSV(e.target.result);
          
          if (!csvData.length) {
            throw new Error('No data found in CSV file');
          }
          
          const staffData = csvData.map(row => ({
            department: row['Department'] || '',
            office: row['Office'] || '',
            fullName: row['Full Name'] || '',
            postTitle: row['Post Title'] || '',
            officeTel: row['Office Tel'] || '',
            normalizedName: normalizeName(row['Full Name'] || ''),
            displayName: removeTitle(row['Full Name'] || ''),
            uploadedAt: firebase.firestore.FieldValue.serverTimestamp()
          }));
          
          const validStaffData = staffData.filter(staff => 
            staff.fullName && staff.department
          );
          
          if (validStaffData.length === 0) {
            throw new Error('No valid staff data found');
          }
          
          const batch = db.batch();
          validStaffData.forEach(staff => {
            const docRef = db.collection('staff').doc();
            batch.set(docRef, staff);
          });
          
          await batch.commit();
          
          showStatus(status, 'success', `✅ Successfully uploaded ${validStaffData.length} staff records`);
          fileInput.value = '';
          
          await loadAllData();
          
        } catch (error) {
          showStatus(status, 'error', `❌ Error: ${error.message}`);
        }
      };
      
      reader.readAsText(file);
    }

    // Upload postings
    async function uploadPostings() {
      const input = document.getElementById('jsonInput').value;
      const status = document.getElementById('postingStatus');
      
      if (!input.trim()) {
        showStatus(status, 'error', '❌ Please enter JSON data');
        return;
      }
      
      status.innerHTML = '<span class="loader"></span> Uploading postings...';
      status.className = 'status info';
      
      try {
        const data = JSON.parse(input);
        if (!Array.isArray(data)) {
          throw new Error('Data must be a JSON array');
        }
        
        const batch = db.batch();
        data.forEach(posting => {
          const docRef = db.collection('postings').doc();
          batch.set(docRef, {
            ...posting,
            normalizedName: normalizeName(posting.name || ''),
            uploadedAt: firebase.firestore.FieldValue.serverTimestamp()
          });
        });
        
        await batch.commit();
        
        showStatus(status, 'success', `✅ Successfully uploaded ${data.length} posting notices`);
        document.getElementById('jsonInput').value = '';
        
        await loadAllData();
        
      } catch (error) {
        showStatus(status, 'error', `❌ Error: ${error.message}`);
      }
    }

    // Clear staff data
    async function clearStaffData() {
      if (!confirm('Are you sure you want to delete all staff data?')) return;
      
      const status = document.getElementById('csvStatus');
      status.innerHTML = '<span class="loader"></span> Clearing staff data...';
      status.className = 'status info';
      
      try {
        const snapshot = await db.collection('staff').get();
        const batch = db.batch();
        
        snapshot.forEach(doc => {
          batch.delete(doc.ref);
        });
        
        await batch.commit();
        
        showStatus(status, 'success', '✅ All staff data cleared');
        await loadAllData();
        
      } catch (error) {
        showStatus(status, 'error', `❌ Error: ${error.message}`);
      }
    }

    // Clear postings input
    function clearPostingsInput() {
      document.getElementById('jsonInput').value = '';
    }

    // Show status
    function showStatus(element, type, message) {
      element.textContent = message;
      element.className = `status ${type}`;
      element.style.display = 'block';
      
      setTimeout(() => {
        element.style.display = 'none';
      }, 5000);
    }

    // Close modal on outside click
    window.onclick = function(event) {
      if (event.target.classList.contains('modal')) {
        event.target.style.display = 'none';
      }
    }
  </script>
</body>
</html>